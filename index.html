<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <link href="https://fonts.googleapis.com/css2?family=Chocolate+Classical+Sans&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>èª²è¡¨</title>
  <style>
    body {
      font-family: 'Chocolate Classical Sans', 'Segoe UI', cursive, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f3f0e7;
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .calendar-header button {
      padding: 6px 14px;
      font-size: 16px;
      background-color: #a4c2a8;
      border: none;
      border-radius: 8px;
      color: #4d3c2b;
      cursor: pointer;
    }
    .calendar-header button:hover {
      background-color: #89ac90;
    }
    .calendar-container {
      overflow-x: auto;
      height: auto;
    }
    .calendar-grid {
      touch-action: pan-x pan-y;
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      min-width: 840px;
    }
    .day {
      background: #ffffff;
      padding: 10px;
      border: 2px solid #cfc7b2;
      border-radius: 16px;
      position: relative;
      min-height: 80px;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
      transition: transform 0.1s ease-in-out;
      overflow: visible;
    }
    .day:hover {
      transform: scale(1.02);
      background-color: #33E6CC;
      transition: transform 0.1s ease-in-out, background-color 0.2s ease-in-out;
    }
    .day.selected {
      border: 3px solid #ff884d;
      box-shadow: 0 0 0 3px #ffe1ca;
    }
    .event {
      position: relative;
      cursor: pointer;
    }
    .event .tooltip {
      display: none;
      position: absolute;
      top: 24px;
      left: 0;
      background: #f5e0c7;
      color: #4d3c2b;
      padding: 8px;
      border-radius: 8px;
      z-index: 10001;
      width: 200px;
      white-space: normal;
    }
    .event:hover .tooltip {
      display: block;
    }
    .event .toggle-btn {
      margin-top: 4px;
      font-size: 12px;
      background: none;
      border: none;
      color: #4d3c2b;
      text-decoration: underline;
      cursor: pointer;
    }
    .weekday {
      text-align: center;
      font-weight: bold;
      padding: 5px 0;
      color: #4d5948;
      font-size: 16px;
    }

    .event-panel {
      margin-top: 20px;
      background: #ffffff;
      border: 2px solid #cfc7b2;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
    }
    .event-panel h2 {
      margin: 0 0 12px;
      color: #4d3c2b;
      font-size: 20px;
    }
    .event-list {
      display: grid;
      gap: 12px;
    }
    .event-card {
      border: 1px solid #cfc7b2;
      border-radius: 12px;
      padding: 12px;
      background: #f9f5ec;
    }
    .event-card h3 {
      margin: 0 0 4px;
      font-size: 18px;
      color: #4d3c2b;
    }
    .event-card p {
      margin: 4px 0;
      color: #4d3c2b;
      line-height: 1.5;
    }
    .event-card a {
      color: #3b6d49;
      text-decoration: underline;
      font-weight: 600;
    }
    .event-card .time-tag {
      display: inline-block;
      padding: 2px 8px;
      background: #e2f0e5;
      border-radius: 8px;
      font-size: 14px;
      color: #335538;
      margin-bottom: 6px;
    }
    .empty-message {
      margin: 0;
      color: #4d3c2b;
    }

    @media screen and (max-width: 768px) {
      body {
        height: 100%;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }
      html, body {
        overscroll-behavior: contain;
        -webkit-overflow-scrolling: touch;
        touch-action: pan-x pan-y;
      }
      .calendar-container {
        overflow-x: auto;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }
      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, minmax(240px, 1fr));
        gap: 10px;
        min-width: 1680px;
      }
      .calendar-grid::-webkit-scrollbar {
        height: 6px;
      }
      .calendar-grid::-webkit-scrollbar-thumb {
        background: #cfc7b2;
        border-radius: 4px;
      }
      .calendar-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .event .tooltip {
        position: relative;
        top: auto;
        left: auto;
        width: auto;
        max-width: 90vw;
        margin-top: 6px;
        display: none;
        word-break: break-word;
        white-space: normal;
      }

      .event-panel {
        padding: 14px;
      }
      .event-card h3 {
        font-size: 16px;
      }
      .event-card .time-tag {
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <div class="calendar-header">
    <div>
      <button onclick="changeMonth(-1)" aria-label="ä¸Šä¸€æœˆ">&lt; ä¸Šæœˆ</button>
      <button onclick="changeMonth(1)" aria-label="ä¸‹ä¸€æœˆ">ä¸‹æœˆ &gt;</button>
    </div>
    <h1 id="calendar-title"></h1>
  </div>
  <div class="calendar-container">
    <div class="calendar-grid" id="calendar-weekdays"></div>
    <div class="calendar-grid" id="calendar-days"></div>
  </div>

  <section class="event-panel" aria-live="polite">
    <h2 id="event-panel-title">é»æ“Šæ—¥æœŸæŸ¥çœ‹æ´»å‹•</h2>
    <div class="event-list" id="event-list"></div>
    <p class="empty-message" id="event-empty-message">å°šæœªé¸æ“‡æ—¥æœŸ</p>
  </section>

  <div id="readme-popup" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#00000088;z-index:10000;display:flex;justify-content:center;align-items:center;">
    <div style="background:#fff8e8;padding:20px;border-radius:12px;max-width:90vw;width:400px;box-shadow:0 4px 8px rgba(0,0,0,0.2);color:#4d3c2b;font-size:16px;line-height:1.5;position:relative">
      <button onclick="document.getElementById('readme-popup').style.display='none'" style="position:absolute;top:8px;right:10px;background:none;border:none;font-size:20px;cursor:pointer">Ã—</button>
      <p>â€» é»æ“Šèª²ç¨‹ titleï¼Œæœƒè·³åˆ°å ±åé€£çµï¼›å¦‚æœè·³å›ç²‰çµ²é çš„è«‹ç§è¨Šæˆ‘å ±åã€‚</p>
      <p>â€» â˜† = ä¸Šåˆçš„æ´»å‹•ã€â˜… = ä¸‹åˆçš„æ´»å‹•ã€âœª = å¤œé–“çš„æ´»å‹•</p>
      <p>â€» èª²è¡¨ä¸æœƒå…¨éƒ¨åœ¨ä¸Šé¢ï¼Œé¡æ»¿æˆ–æ˜¯ç¶²é ç¶­è­·å›°é›£æˆ‘å°±æœƒç§»é™¤æ‰äº†ï¼›è¦ç´„æ™‚é–“ã€è¨±é¡˜èª²ç¨‹é–‹èª²è«‹ç›´æ¥ç§è¨Šæˆ‘ã€‚</p>
      <p>ğŸ‘‰ ä»»ä½•æŠ€è¡“å•é¡Œè«‹æ´½ã€Œç‘‹ç‘‹è€å¸«çš„æ’’é‡è¨˜äº‹éŒ„ã€Facebook ç²‰çµ²é ã€‚</p>
    </div>
  </div>

  <script>
    let eventsByDate = {};
    let currentDate = new Date();
    let selectedDate = null;

    fetch('events.json')
      .then(response => response.json())
      .then(data => {
        eventsByDate = data;
        renderWeekdays();
        renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
        const todayStr = formatDateKey(new Date());
        if (eventsByDate[todayStr]) {
          showEvents(todayStr);
        } else {
          setEmptyMessage('è«‹é»æ“Šæ—¥æœŸæŸ¥çœ‹æ´»å‹•');
        }
      })
      .catch(err => {
        console.error('è®€å– events.json å¤±æ•—:', err);
        setEmptyMessage('æ´»å‹•è³‡è¨Šè¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
      });

    document.addEventListener('click', function(e) {
      const isTooltipOrButton = e.target.closest('.tooltip') || e.target.classList.contains('toggle-btn');
      if (!isTooltipOrButton) {
        document.querySelectorAll('.tooltip').forEach(t => t.style.display = 'none');
      }
    });

    function renderWeekdays() {
      const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
      const weekdayContainer = document.getElementById('calendar-weekdays');
      weekdayContainer.innerHTML = '';
      weekdays.forEach(day => {
        const div = document.createElement('div');
        div.className = 'weekday';
        div.textContent = day;
        weekdayContainer.appendChild(div);
      });
    }

    function renderCalendar(year, month) {
      const calendarTitle = document.getElementById('calendar-title');
      const calendarDays = document.getElementById('calendar-days');
      calendarDays.innerHTML = '';

      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const totalDays = lastDay.getDate();
      const startDay = firstDay.getDay();

      calendarTitle.textContent = `${year} å¹´ ${month + 1} æœˆè¡Œäº‹æ›†`;

      for (let i = 0; i < startDay; i++) {
        const emptyDiv = document.createElement('div');
        emptyDiv.className = 'day';
        calendarDays.appendChild(emptyDiv);
      }

      for (let day = 1; day <= totalDays; day++) {
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const events = eventsByDate[dateStr];
        const div = document.createElement('div');
        div.className = 'day';
        div.dataset.date = dateStr;
        div.setAttribute('role', 'button');
        div.setAttribute('tabindex', '0');
        div.setAttribute('aria-label', `${month + 1}æœˆ${day}æ—¥`);

        const isToday = (year === new Date().getFullYear() && month === new Date().getMonth() && day === new Date().getDate());
        if (isToday && selectedDate === null) {
          div.classList.add('selected');
        }
        if (selectedDate === dateStr) {
          div.classList.add('selected');
        }

        div.addEventListener('click', () => showEvents(dateStr));
        div.addEventListener('keypress', (event) => {
          if (event.key === 'Enter' || event.key === ' ') {
            event.preventDefault();
            showEvents(dateStr);
          }
        });

        if (events) {
          const header = document.createElement('strong');
          header.textContent = `${month + 1}/${day}`;
          div.appendChild(header);

          events.forEach(event => {
            const tooltipHTML = event.tooltip.replace(/\n/g, '<br>');
            let icon = 'â˜…';
            if (/\d{2}:\d{2}/.test(event.time)) {
              const [hour] = event.time.split(':').map(Number);
              if (hour < 12) icon = 'â˜†';
              else if (hour >= 17) icon = 'âœª';
            }

            const entry = document.createElement('div');
            entry.className = 'event';

            const titleLink = document.createElement('u');
            titleLink.textContent = `${event.title}`;
            titleLink.style.cursor = 'pointer';
            titleLink.style.textDecoration = 'underline';
            titleLink.style.color = '#4d3c2b';
            titleLink.onclick = () => window.open(event.url);

            const titleDiv = document.createElement('div');
            titleDiv.innerHTML = `${icon} `;
            titleDiv.appendChild(titleLink);

            const toggleButton = document.createElement('button');
            toggleButton.className = 'toggle-btn';
            toggleButton.textContent = 'é¡¯ç¤º/éš±è—èªªæ˜';
            toggleButton.onclick = function (e) {
              toggleTooltip(this);
              e.stopPropagation();
            };

            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            tooltip.innerHTML = `${icon} ${event.title}ï¼š${event.time}<br>${tooltipHTML}`;

            entry.appendChild(titleDiv);
            entry.appendChild(toggleButton);
            entry.appendChild(tooltip);
            div.appendChild(entry);
          });
        } else {
          div.textContent = `${month + 1}/${day}`;
        }

        calendarDays.appendChild(div);
      }
    }

    function toggleTooltip(button) {
      const allTooltips = document.querySelectorAll('.tooltip');
      allTooltips.forEach(tip => tip.style.display = 'none');
      const tooltip = button.nextElementSibling;
      if (tooltip.style.display !== 'block') {
        tooltip.style.display = 'block';
      }
    }

    function changeMonth(offset) {
      currentDate.setMonth(currentDate.getMonth() + offset);
      selectedDate = null;
      renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
      resetEventPanel();
    }

    function formatDateKey(date) {
      return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
    }

    function formatDisplayDate(dateStr) {
      const [year, month, day] = dateStr.split('-');
      return `${year} å¹´ ${Number(month)} æœˆ ${Number(day)} æ—¥ æ´»å‹•`;
    }

    function resetEventPanel() {
      document.getElementById('event-panel-title').textContent = 'é»æ“Šæ—¥æœŸæŸ¥çœ‹æ´»å‹•';
      document.getElementById('event-list').innerHTML = '';
      setEmptyMessage('å°šæœªé¸æ“‡æ—¥æœŸ');
    }

    function setEmptyMessage(message) {
      const emptyMessageEl = document.getElementById('event-empty-message');
      emptyMessageEl.textContent = message;
      emptyMessageEl.style.display = message ? 'block' : 'none';
    }

    function showEvents(dateStr) {
      selectedDate = dateStr;
      document.querySelectorAll('.day').forEach(dayEl => {
        if (dayEl.dataset.date) {
          dayEl.classList.toggle('selected', dayEl.dataset.date === dateStr);
        }
      });

      const eventListEl = document.getElementById('event-list');
      const panelTitleEl = document.getElementById('event-panel-title');

      const events = eventsByDate[dateStr];
      panelTitleEl.textContent = formatDisplayDate(dateStr);
      eventListEl.innerHTML = '';

      if (!events || events.length === 0) {
        setEmptyMessage('æ­¤æ—¥æœŸæ²’æœ‰æ´»å‹•ï¼Œæ­¡è¿é¸æ“‡å…¶ä»–æ—¥æœŸ');
        return;
      }

      setEmptyMessage('');
      events.forEach(event => {
        const card = document.createElement('div');
        card.className = 'event-card';

        const title = document.createElement('h3');
        title.textContent = event.title;

        const timeTag = document.createElement('div');
        timeTag.className = 'time-tag';
        timeTag.textContent = event.time;

        const description = document.createElement('p');
        description.innerHTML = event.tooltip.replace(/\n/g, '<br>');

        const link = document.createElement('a');
        link.href = event.url;
        link.target = '_blank';
        link.rel = 'noopener noreferrer';
        link.textContent = 'å‰å¾€æ´»å‹•å ±å';

        card.appendChild(title);
        card.appendChild(timeTag);
        card.appendChild(description);
        card.appendChild(link);
        eventListEl.appendChild(card);
      });
    }
  </script>
</body>
</html>
